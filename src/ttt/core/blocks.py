import numpy as np

"""
https://en.wikipedia.org/wiki/Symbols_for_Legacy_Computing_Supplement
U+1CD0x ğœ´€ ğœ´ ğœ´‚ ğœ´ƒ ğœ´„ ğœ´… ğœ´† ğœ´‡ ğœ´ˆ ğœ´‰ ğœ´Š ğœ´‹ ğœ´Œ ğœ´ ğœ´ ğœ´
U+1CD1x ğœ´ ğœ´‘ ğœ´’ ğœ´“ ğœ´” ğœ´• ğœ´– ğœ´— ğœ´˜ ğœ´™ ğœ´š ğœ´› ğœ´œ ğœ´ ğœ´ ğœ´Ÿ
U+1CD2x ğœ´  ğœ´¡ ğœ´¢ ğœ´£ ğœ´¤ ğœ´¥ ğœ´¦ ğœ´§ ğœ´¨ ğœ´© ğœ´ª ğœ´« ğœ´¬ ğœ´­ ğœ´® ğœ´¯
U+1CD3x ğœ´° ğœ´± ğœ´² ğœ´³ ğœ´´ ğœ´µ ğœ´¶ ğœ´· ğœ´¸ ğœ´¹ ğœ´º ğœ´» ğœ´¼ ğœ´½ ğœ´¾ ğœ´¿
U+1CD4x ğœµ€ ğœµ ğœµ‚ ğœµƒ ğœµ„ ğœµ… ğœµ† ğœµ‡ ğœµˆ ğœµ‰ ğœµŠ ğœµ‹ ğœµŒ ğœµ ğœµ ğœµ
U+1CD5x ğœµ ğœµ‘ ğœµ’ ğœµ“ ğœµ” ğœµ• ğœµ– ğœµ— ğœµ˜ ğœµ™ ğœµš ğœµ› ğœµœ ğœµ ğœµ ğœµŸ
U+1CD6x ğœµ  ğœµ¡ ğœµ¢ ğœµ£ ğœµ¤ ğœµ¥ ğœµ¦ ğœµ§ ğœµ¨ ğœµ© ğœµª ğœµ« ğœµ¬ ğœµ­ ğœµ® ğœµ¯
U+1CD7x ğœµ° ğœµ± ğœµ² ğœµ³ ğœµ´ ğœµµ ğœµ¶ ğœµ· ğœµ¸ ğœµ¹ ğœµº ğœµ» ğœµ¼ ğœµ½ ğœµ¾ ğœµ¿
U+1CD8x ğœ¶€ ğœ¶ ğœ¶‚ ğœ¶ƒ ğœ¶„ ğœ¶… ğœ¶† ğœ¶‡ ğœ¶ˆ ğœ¶‰ ğœ¶Š ğœ¶‹ ğœ¶Œ ğœ¶ ğœ¶ ğœ¶
U+1CD9x ğœ¶ ğœ¶‘ ğœ¶’ ğœ¶“ ğœ¶” ğœ¶• ğœ¶– ğœ¶— ğœ¶˜ ğœ¶™ ğœ¶š ğœ¶› ğœ¶œ ğœ¶ ğœ¶ ğœ¶Ÿ
U+1CDAx ğœ¶  ğœ¶¡ ğœ¶¢ ğœ¶£ ğœ¶¤ ğœ¶¥ ğœ¶¦ ğœ¶§ ğœ¶¨ ğœ¶© ğœ¶ª ğœ¶« ğœ¶¬ ğœ¶­ ğœ¶® ğœ¶¯
U+1CDBx ğœ¶° ğœ¶± ğœ¶² ğœ¶³ ğœ¶´ ğœ¶µ ğœ¶¶ ğœ¶· ğœ¶¸ ğœ¶¹ ğœ¶º ğœ¶» ğœ¶¼ ğœ¶½ ğœ¶¾ ğœ¶¿
U+1CDCx ğœ·€ ğœ· ğœ·‚ ğœ·ƒ ğœ·„ ğœ·… ğœ·† ğœ·‡ ğœ·ˆ ğœ·‰ ğœ·Š ğœ·‹ ğœ·Œ ğœ· ğœ· ğœ·
U+1CDDx ğœ· ğœ·‘ ğœ·’ ğœ·“ ğœ·” ğœ·• ğœ·– ğœ·— ğœ·˜ ğœ·™ ğœ·š ğœ·› ğœ·œ ğœ· ğœ· ğœ·Ÿ
U+1CDEx ğœ·  ğœ·¡ ğœ·¢ ğœ·£ ğœ·¤ ğœ·¥
...
U+1CEAx ğœº      ğœº£         ğœº¨     ğœº«

https://en.wikipedia.org/wiki/Symbols_for_Legacy_Computing
U+1FB8x     ğŸ®‚     ğŸ®…
...
U+1FBEx             ğŸ¯¦ ğŸ¯§

https://en.wikipedia.org/wiki/Block_Elements
U+258x  â–€   â–‚   â–„   â–†   â–ˆ   â–Š   â–Œ
U+259x  â–           â–– â–— â–˜ â–™ â–š â–› â–œ â– â– â–Ÿ
"""


block_map = """
  ğœº¨ ğœº« ğŸ®‚ ğœ´€ â–˜ ğœ´ ğœ´‚ ğœ´ƒ ğœ´„ â– ğœ´… ğœ´† ğœ´‡ ğœ´ˆ â–€
ğœ´‰ ğœ´Š ğœ´‹ ğœ´Œ ğŸ¯¦ ğœ´ ğœ´ ğœ´ ğœ´ ğœ´‘ ğœ´’ ğœ´“ ğœ´” ğœ´• ğœ´– ğœ´—
ğœ´˜ ğœ´™ ğœ´š ğœ´› ğœ´œ ğœ´ ğœ´ ğœ´Ÿ ğŸ¯§ ğœ´  ğœ´¡ ğœ´¢ ğœ´£ ğœ´¤ ğœ´¥ ğœ´¦
ğœ´§ ğœ´¨ ğœ´© ğœ´ª ğœ´« ğœ´¬ ğœ´­ ğœ´® ğœ´¯ ğœ´° ğœ´± ğœ´² ğœ´³ ğœ´´ ğœ´µ ğŸ®…
ğœº£ ğœ´¶ ğœ´· ğœ´¸ ğœ´¹ ğœ´º ğœ´» ğœ´¼ ğœ´½ ğœ´¾ ğœ´¿ ğœµ€ ğœµ ğœµ‚ ğœµƒ ğœµ„
â–– ğœµ… ğœµ† ğœµ‡ ğœµˆ â–Œ ğœµ‰ ğœµŠ ğœµ‹ ğœµŒ â– ğœµ ğœµ ğœµ ğœµ â–›
ğœµ‘ ğœµ’ ğœµ“ ğœµ” ğœµ• ğœµ– ğœµ— ğœµ˜ ğœµ™ ğœµš ğœµ› ğœµœ ğœµ ğœµ ğœµŸ ğœµ 
ğœµ¡ ğœµ¢ ğœµ£ ğœµ¤ ğœµ¥ ğœµ¦ ğœµ§ ğœµ¨ ğœµ© ğœµª ğœµ« ğœµ¬ ğœµ­ ğœµ® ğœµ¯ ğœµ°
ğœº  ğœµ± ğœµ² ğœµ³ ğœµ´ ğœµµ ğœµ¶ ğœµ· ğœµ¸ ğœµ¹ ğœµº ğœµ» ğœµ¼ ğœµ½ ğœµ¾ ğœµ¿
ğœ¶€ ğœ¶ ğœ¶‚ ğœ¶ƒ ğœ¶„ ğœ¶… ğœ¶† ğœ¶‡ ğœ¶ˆ ğœ¶‰ ğœ¶Š ğœ¶‹ ğœ¶Œ ğœ¶ ğœ¶ ğœ¶
â–— ğœ¶ ğœ¶‘ ğœ¶’ ğœ¶“ â–š ğœ¶” ğœ¶• ğœ¶– ğœ¶— â– ğœ¶˜ ğœ¶™ ğœ¶š ğœ¶› â–œ
ğœ¶œ ğœ¶ ğœ¶ ğœ¶Ÿ ğœ¶  ğœ¶¡ ğœ¶¢ ğœ¶£ ğœ¶¤ ğœ¶¥ ğœ¶¦ ğœ¶§ ğœ¶¨ ğœ¶© ğœ¶ª ğœ¶«
â–‚ ğœ¶¬ ğœ¶­ ğœ¶® ğœ¶¯ ğœ¶° ğœ¶± ğœ¶² ğœ¶³ ğœ¶´ ğœ¶µ ğœ¶¶ ğœ¶· ğœ¶¸ ğœ¶¹ ğœ¶º
ğœ¶» ğœ¶¼ ğœ¶½ ğœ¶¾ ğœ¶¿ ğœ·€ ğœ· ğœ·‚ ğœ·ƒ ğœ·„ ğœ·… ğœ·† ğœ·‡ ğœ·ˆ ğœ·‰ ğœ·Š
ğœ·‹ ğœ·Œ ğœ· ğœ· ğœ· ğœ· ğœ·‘ ğœ·’ ğœ·“ ğœ·” ğœ·• ğœ·– ğœ·— ğœ·˜ ğœ·™ ğœ·š
â–„ ğœ·› ğœ·œ ğœ· ğœ· â–™ ğœ·Ÿ ğœ·  ğœ·¡ ğœ·¢ â–Ÿ ğœ·£ â–† ğœ·¤ ğœ·¥ â–ˆ
"""


int_to_block = block_map[1:-1:2]
int_to_block_inverse = int_to_block[::-1]


def to_block(pixels, x0: int, y0: int, width: int, height: int, invert=False):
    c = 0 if invert else 255

    for y in range(y0, y0 + height, 4):
        line = []
        for x in range(x0, x0 + width, 2):
            block_value = 0
            for i in range(8):
                pixel_x = x + (i % 2)
                pixel_y = y + (i // 2)
                if pixel_x < x0 + width and pixel_y < y0 + height:
                    block_value |= (pixels[pixel_x, pixel_y] == c) << i
            line.append(block_value)
        yield line


# TODO: Optimize
def to_block_numpy(pixels: np.ndarray, x0: int, y0: int, width: int, height: int, invert=False):
    c = 0 if invert else 255

    lines = []
    for y in range(y0, y0 + height, 4):
        line = []
        for x in range(x0, x0 + width, 2):
            block = np.zeros((4, 2), dtype=pixels.dtype)
            block[:min(4, pixels.shape[0] - y), :min(2, pixels.shape[1] - x)] = pixels[y:y + 4, x:x + 2]

            block_bits = (block == c).astype(np.uint8).flatten()
            block_value = np.packbits(block_bits[::-1])[0]

            line.append(block_value)
        lines.append(line)
    return lines
